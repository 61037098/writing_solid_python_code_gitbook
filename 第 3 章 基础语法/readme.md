## 第 3 章 基础语法

### 建议 19：有节制地使用 `from ... import` 语句

Python 提供了 3 钟方式来引入外部模块：`import` 语句、`from ... import ...` 及 `__import__` 函数。其中较为常见的为前面两种，而 `__import__` 函数与 `import` 语句类似，不同点在于前者显式地将模块的名称作为字符串传递并赋值给命名空间的变量。

在使用 `import` 的时候注意以下几点：

* 一般情况下尽量优先使用 `import a` 形式
* 有节制地使用 `from a import B` 形式
* 尽量避免使用 `from a import *`，因为这会污染命名空间

Python 在初始化运行环境的时候会预先加载一批内建模块到内存中，这些模块相关的信息被存放在 `sys.modules` 中。读者导入 sys 模块后在 Python 解释器中输入 `sys.modules.items()` 便可显示所有预加载模块的相关信息。当加载一个模块的时候，解释器实际上要完成以下动作：

* 在 `sys.modules` 中进行搜索看看该模块是否已经存在，如果存在，则将其导入到当前局部命名空间，加载结束
* 如果在 `sys.modules` 中找不到对应模块的名称，则为需要导入的模块创建一个字典对象，并将该对象信息插入 `sys.modules` 中
* 加载前确认是否需要对模块对应的文件进行编译，如果需要则先进行编译
* 执行动态加载，在当前模块的命名空间中执行编译后的字节码，并将其中所有的对象放入模块对应的字典中

对于用户定义的模块，import 机制会创建一个新的 module 将其加入当前的局部命名空间中，与此同时，`sys.modules` 也加入了该模块的相关信息。但从 id 输出的结果可以看出，本质上是引用同一个对象。同时会发现所在的目录下多了一个 `.pyc` 的文件，该文件为解释器生成的模块对应的字节码，从 `import  `之后的输出可以看出模块同时被执行。

需要注意的是，直接使用 `import` 和使用 `from a import B` 形式这两者之间存在一定的差异，后者直接将 B 暴露于当前局部空间，而将 a 加载到 `sys.modules` 集合。

对于 `from a import ...` 无节制的使用会带来什么问题：

* 命名空间的冲突
  * 一般来说在非常明确不会造成命名冲突的前提下，以下几种情况下可以考虑使用 `from ... import` 语句：
    * 当只需要导入部分属性或方法时
    * 模块中的这些属性和方法访问频率较高导致使用 "模块名.名称" 的形式进行访问过于繁琐时
    * 模块的文档明确说明需要使用 `from ... import` 形式，导入的是一个包下面的子模块，且使用 `from ... import` 形式能够更为简单和便利时。
* 循环嵌套导入的问题
  * 解决循环嵌套导入问题的一个方法是直接使用 import 语句

### 建议 20：优先使用 `absolute import` 来导入模块

